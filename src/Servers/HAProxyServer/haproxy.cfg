global
    log stdout format raw local0
    lua-load /usr/local/etc/haproxy/echo.lua

defaults
    mode http
    timeout client 10s
    timeout connect 5s
    timeout server 10s

frontend http_in
    bind *:8080
    use_backend echo_backend if { path /echo }
    use_backend cookie_backend if { path /cookie }
    use_backend post_echo_backend if { method POST }
    http-request return status 200 content-type "text/plain" string "OK"

backend echo_backend
    http-request use-service lua.echo

backend cookie_backend
    http-request use-service lua.cookie

backend post_echo_backend
    http-request use-service lua.echo_body
